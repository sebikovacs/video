var app=angular.module("videoLoop",["ngRoute","ngTouch","monospaced.mousewheel","LocalForageModule"]).config(["$routeProvider",function(a){"use strict";a.when("/",{templateUrl:"views/videoloop.html",controller:"MainCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/"})}]).config(["$localForageProvider",function(a){a.config({driver:"localStorageWrapper",name:"myApp",version:1,storeName:"keyvaluepairs",description:"some description"})}]);app.run(function(){}),app.controller("MainCtrl",function(a,b){"use strict";var c=$("video")[0];b.notPlaying=!0,b.layout={addTrack:!1},b.tracks=JSON.parse(localStorage.getItem("tracks"))||[],b.$watch("selectedTrack.startTime",function(){b.save()}),b.$watch("selectedTrack.endTime",function(){b.save()}),b.$watch("selectedTrack.loop",function(){b.save()}),b.$watch("selectedTrack.speed",function(){b.save()}),b.save=function(){localStorage.setItem("tracks",angular.toJson(b.tracks))},b.ShowTrack=function(){b.layout.addTrack=!0},b.AddTrack=function(){b.track={startTime:0,endTime:0,loop:0,speed:1,description:""},b.tracks.push(b.track),b.save()},b.SelectTrack=function(a){b.itemIndex=a,b.selectedTrack=b.tracks[a],c.currentTime=b.selectedTrack.startTime,b.Pause()},b.Play=function(){c.playbackRate=b.selectedTrack.speed,c.play(),b.notPlaying=!1},b.Pause=function(){c.pause(),b.notPlaying=!0},0==b.tracks.length&&b.AddTrack(),b.selectedTrack=b.tracks[0],$(c).on("timeupdate",function(){b.notPlaying||Math.floor(c.currentTime)==Math.floor(b.selectedTrack.endTime)&&(c.currentTime=b.selectedTrack.startTime,b.selectedTrack.loop>0?b.selectedTrack.loop=b.selectedTrack.loop-1:c.pause())})}),app.directive("range",function(a){"use strict";return{require:"ngModel",template:'<a href="" class="fa fa-trash-o" ng-click="Delete()"></a>              <h5>{{ngModel.description}}</h5>              <div class="range-holder">                  <div class="range-track"></div>                  <div class="range-selection"></div>                  <div class="range-handle left-handle"></div>                  <div class="range-handle right-handle"></div>                </div>                <div class="playback-control">                  <div class="playback-group">                    <span class="pb-label">Loops:</span>                    <a href="" class="fa fa-minus-square" ng-click="MinusLoop()"></a>                    <span class="val" msd-wheel="ManageLoop($event, $delta, $deltaX, $deltaY)">{{ngModel.loop}}</span>                    <a href="" class="fa fa-plus-square" ng-click="PlusLoop()"></a>                  </div>                  <div class="playback-group">                    <span class="pb-label">Speed:</span>                    <a href="" class="fa fa-minus-square" ng-click="MinusSpeed()"></a>                    <span class="val" msd-wheel="ManageSpeed($event, $delta, $deltaX, $deltaY)">{{ngModel.speed * 100}}%</span>                    <a href="" class="fa fa-plus-square" ng-click="PlusSpeed()"></a>                  </div>                </div>              </div>',scope:{ngModel:"=",ngTracks:"="},link:function(b,c){b.ngModel.description?b.ngModel.description:b.ngModel.description="Track name",b.Delete=function(){var a=b.ngTracks.indexOf(b.ngModel);b.ngTracks.splice(a,1)},b.MinusLoop=function(){b.ngModel.loop>0&&b.ngModel.loop--},b.PlusLoop=function(){b.ngModel.loop++},b.MinusSpeed=function(){if(b.ngModel.speed>.1){var a=b.ngModel.speed-.1;b.ngModel.speed=Math.round(100*a)/100}},b.PlusSpeed=function(){if(b.ngModel.speed<1){var a=b.ngModel.speed+.1;b.ngModel.speed=Math.round(100*a)/100}},b.ManageLoop=function(a,c){a.preventDefault(),c>0?b.ngModel.loop++:b.ngModel.loop>0&&b.ngModel.loop--},b.ManageSpeed=function(a,c){if(a.preventDefault(),c>0){if(b.ngModel.speed<1){var d=b.ngModel.speed+.1;b.ngModel.speed=Math.round(100*d)/100}}else if(b.ngModel.speed>0){var d=b.ngModel.speed-.1;b.ngModel.speed=Math.round(100*d)/100}},$.fn.rangeSelector=function(c){var d,e=$(this),f=e.find(".range-track"),g=e.find(".range-selection"),h=(g.width(),e.find(".range-handle:first")),i=e.find(".range-handle:last"),j=c.video,k=!1,l=0,m=[0,0],n=c.duration||120,o=window.setInterval(function(){j[0].readyState>0&&(n=j[0].duration,u(),clearInterval(o))},100),p=function(a){var b=a.pageX,c=f.offset().left+f[0].offsetWidth,d=f.offset().left;l=Math.min(Math.max(d,b),c)-f.offset().left},q=function(a){var b=f.width()/n,c=parseInt(a/b);return c},r=function(a){k&&(p(a),0==d&&m[1]<l?(m[0]=m[1],d=1):1==d&&m[0]>l&&(m[1]=m[0],d=0),m[d]=l,j[0].currentTime=q(l),v())},s=function(){k=!1},t=function(a){k=!0,p(a);var b=Math.abs(l-m[0]),c=Math.abs(l-m[1]);d=c>b?0:1,m[d]=l,j[0].currentTime=q(l),v(),e.on({mousemove:r})},u=function(){var a=f.width()/n;h[0].style.left=parseInt(b.ngModel.startTime*a)+"px",i[0].style.left=parseInt(b.ngModel.endTime*a)+"px",g[0].style.left=b.ngModel.startTime*a+"px",g.width(b.ngModel.endTime*a-b.ngModel.startTime*a),m[0]=parseInt(b.ngModel.startTime*a),m[1]=parseInt(b.ngModel.endTime*a)},v=function(){h[0].style.left=m[0]+"px",i[0].style.left=m[1]+"px",g[0].style.left=m[0]+"px",g.width(m[1]-m[0]);var c=f.width()/n,d=parseInt(m[0]/c),e=parseInt(m[1]/c);a(function(){b.ngModel.startTime=d,b.ngModel.endTime=e})};e.on({mousedown:t,mouseup:s})},$(c).find(".range-holder").rangeSelector({video:$("video")})}}}),angular.module("videoLoop").run(["$templateCache",function(a){"use strict";a.put("views/videoloop.html",'<div class="main-col">\n  <div class="video-wrap">\n    <div class="video">\n      <video id="demo" src="images/salsa.mp4" ></video>    \n    </div>\n  </div>\n\n  <section class="track-select">\n    <div class="tools">\n      <div class="video-controls">\n        <a href="" ng-click="Play()" class="" ng-show="notPlaying"><i class="fa fa-play"></i></a>\n        <a href="" ng-click="Pause()" class="" ng-hide="notPlaying"><i class="fa fa-pause"></i></a>\n      </div>\n      <div class="time">\n        <span>{{selectedTrack.startTime}}"</span>-<span>{{selectedTrack.endTime}}"</span>\n      </div>\n    </div>\n    \n    <a href="" ng-click="AddTrack()" class="btn add-track">Add track</a>\n\n    <div class="tracks-wrap">\n      <ul class="tracks">\n        <li ng-repeat="item in tracks track by $index" ng-click="SelectTrack($index)" ng-class="{\'active\': $index == itemIndex}">\n          <div range ng-model="item" ng-tracks="tracks"></div>\n        </li>\n      </ul>\n    </div>\n  </section>\n</div>\n<aside>\n</aside>\n')}]);